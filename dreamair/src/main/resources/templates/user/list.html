<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/thymeleaf-extras-springsecurity5"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/UI/layout/main_layout}"
      >
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>개발을 꿈꾸는 항공사</title>


</head>

<body layout:fragment="content">

    <div class="container">

        <h1 style="text-align: center;">항공권 조회</h1>
        <h2 style="text-align: center;">가는편</h2>
        <!-- 출발지 - 목적지를 보여주는 섹션 -->
        <section>
            
            <div id="flight_box">
                <!-- 출발지 - 목적지를 보여주는 박스 -->
            </div>
            
        </section>
        
        <!-- 이전날짜 다음날짜 목록을 보여줘서 해당날짜 항공권 목록을 보여주는 섹션(옵션) -->
        <section></section>
        
        <!-- 항공권 목록을 보여주는 섹션 -->
        <section id="goWay">
            
            <!-- 
            <table class="table table-striped table-hover table-bordered text-center align-middle" id="productTable" style="margin-top: 100px;">

                <tr class="table-primary">
                    <th>운항시간</th> 
                    <th>항공사</th> 
                    <th>편명</th> 
                    <th>가격</th>  
                    <th>잔여좌석</th>
                    <th>장바구니</th>
                    <th>예매하기</th>
                </tr>

                <th:block th:if="${bookingList.isEmpty()}">
                    <tr>
                        <td colspan="13">조회된 항공권이 없습니다.</td>
                    </tr>
                </th:block>
                
                    <th:block th:each="booking : ${bookingList}">
                        <form action="/booking/info">
                            <tr>
                                <td><span th:text="${booking.duration}"></span></td> 
                                <td>DramAir</td> 
                                <td><span th:text="${booking.flightName}"></span></td> 
                                <td><span th:text="${booking.productPrice}"></span></td>  
                                <td><span th:text="${booking.seatRemaining}"></span></td>
                                <td><a href="" class="btn btn-outline-primary btn-lg">장바구니</a></td>
                                <input type="hidden" name="productNo" th:value="${booking.productNo}" >
                                <input type="hidden" name="routeNo" th:value="${booking.routeNo}" >
                                <td><input type="submit" value="예매하기" class="btn btn-outline-primary btn-lg"></td>
                            </tr>
                        </form>
                    </th:block>
                    
            </table> 
            -->
            <!-- <input type="hidden" name="producId" th:value="${booking.producId}" > -->
            <!-- 좌석번호, 예매번호는 나중에 insert문 말고 update문으로 값을 추가 -->

        </section>

        <!-- 오는편 -->
        <h2 style="text-align: center;">오는편</h2>
        <section id="comeWay"> 

        </section>

        <div class="d-flex justify-content-between">
            <a href="/" class="btn btn-outline-primary btn-lg">메인으로 가기</a>
        </div>
    </div>
    
    <script>

        let roundTrip = "[[${booking.roundTrip}]]"
        let departure = "[[${booking.departure}]]"
        let destination = "[[${booking.destination}]]"
        let departureDate = "[[${booking.departureDate}]]"
        let pasCount = "[[${booking.pasCount}]]"
        let productIdDep = "[[${bookingList.get(0).productId}]]"
        let productIdDes = "[[${booking.productId}]]"
        let productNoDep = "[[${booking.productNo}]]"
        let productNoDes = "[[${booking.productNo}]]"

        goWay()

        // 가는편 조회
        function goWay() {

            const url = "/booking/component/golist"

            const data = {
                roundTrip: roundTrip,
                departure: departure,
                destination: destination,
                departureDate: departureDate,
                pasCount: pasCount
            };


            $.ajax({
                url     : url,
                type    : 'GET',
                data    : data,
                success : function(response) {
                    console.log(response);
                    $('#goWay').html(response)
                },
                error           : function(request, status, error){
                    alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
                }

            })
            
        }

        $(function() {

            $('.btn-select').on("click", function() {
                $('#goWay').hide();
                // 값을 넘겨주는 처리?
                roundTrip = '도착'
                alert(productIdDep)
                comeWay();
            })

        })

        // 오는편 조회
        function comeWay() {

            const url = "/booking/component/comelist"

            const data = {
                roundTrip: roundTrip,
                departure: destination,
                destination: departure,
                departureDate: departureDate,   // 돌아오는 날 값을 넘겨줘야해
                pasCount: pasCount
                // roundTrip: '도착',
                // departure: '김포',
                // destination: '제주',
                // departureDate: '2023/11/06',
                // pasCount: 4
            };


            $.ajax({
                url     : url,
                type    : 'GET',
                data    : data,
                success : function(response) {
                    console.log(response);
                    $('#comeWay').html(response)
                },
                error           : function(request, status, error){
                    alert("code:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
                }

            })
        }
            
        // 선택할때 booking에 값을 넣고 예매하기 할때도 booking에 값을 넣어서 info로 넘겨서 info에서 탑승객 정보입력시 디비에 입력
        // data에 히든값 포함해서 데이터 전송
        // 선택하기 눌렀을 때()
        

        // 예매하기 눌렀을 때()
        
    </script>

</body>
</html>